<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function($scope, $rootScope) {
  /* widget controller */
  var c = this;
	c.selectItem = function(idx){
		var id = c.data.notes[idx].sys_id; // get sys_id of item selected
		console.log('Note ID: ', id); // log the sys_id on console
		$rootScope.noteID = id; // set the noteID property to sys_id
		$rootScope.$emit('selectNote',id); // emit the id to selectNote
	}

	$rootScope.$on('refreshList', function(event, data){
		console.log($rootScope.noteID);
		c.server.get({
			action: 'updateList',
			noteID: $rootScope.noteID
		}).then(
		function(response){
			
		});
	});
}]]></client_script>
        <controller_as>c</controller_as>
        <css/>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>notes_list</id>
        <internal>false</internal>
        <link/>
        <name>Notes List</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
	/* populate the 'data' object */
	/* e.g., data.table = $sp.getValue('table'); */
	/*
			SO, we want the following:
				Create notes property on data object which will contain an arr of objects
				Query db to find all Note table record for currently logged user
				Sort records by descending order based on sys_created_on data field value
				For each Note records returned
					Create empty object, noteObj
					Get display values for number, title, sys_id fields and put those values
						into the noteObj object
					Get first 20 characters of description field and add that value to noteObj
						object
					Push the noteObj into note array

	*/
	data.notes = [];
	var gr = new GlideRecord('x_snc_createnotes_note');
	gr.addQuery('user',gs.getUser().getID());
	gr.orderByDesc("sys_created_on");
	gr.query();
	
	if(input && input.noteID){
			note = new GlideRecord('x_snc_createnotes_note');
			if(note.get(input.noteID)){
				if(input.action == 'updateList'){
					var noteObj2 = {};
					$sp.getRecordDisplayValues(noteObj2, note, 'number,title,sys_id');
					noteObj2.note = note.getValue('note').slice(0,20);
					data.notes.push(noteObj2);
					console.log(noteObj2.note);
				}
			}
		}
	
		while(gr.next()){
			var noteObj = {};
			/*
			var i = gr.getDisplayValue('number');
			var j = gr.getDisplayValue('title');
			var k = gr.getDisplayValue('sys_id');
			*/
			// can also use Service Portal Helper method
			$sp.getRecordDisplayValues(noteObj, gr, 'number,title,sys_id');
			noteObj.note = gr.getValue('note').slice(0,20);
			data.notes.push(noteObj);
		}
	
	

})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2018-10-02 01:56:01</sys_created_on>
        <sys_id>7167af0737b823007595dc1873990e19</sys_id>
        <sys_mod_count>57</sys_mod_count>
        <sys_name>Notes List</sys_name>
        <sys_package display_value="CreateNotes" source="x_snc_createnotes">df5fd9a5090232007f44e1046c8ff69f</sys_package>
        <sys_policy/>
        <sys_scope display_value="CreateNotes">df5fd9a5090232007f44e1046c8ff69f</sys_scope>
        <sys_update_name>sp_widget_7167af0737b823007595dc1873990e19</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2018-10-02 18:53:37</sys_updated_on>
        <template><![CDATA[<div class = "panel panel-default">
<!-- your widget template -->
  <div class = "panel-heading clearfix">
    <h3 class = "panel-title pull-left">
      ${Notes}
    </h3>
    
  </div>
  <div class = "list-group">
    <a class = "list-group-item" ng-click = "c.selectItem($index)"
       ng-repeat= "note in data.notes">
      <!-- c.selectItem makes the thingy go grey when hovered over-->
      <h3 class = "list-group-item-heading">
        {{note.title}}
      </h3>
      <p class = "list-group-item-text">
        {{note.note}}
      </p>
    </a>
  </div>

</div>]]></template>
    </sp_widget>
</record_update>
